import requests

api_key="470f77939d3d8c6cfc284916dc75e011784d5eb0d67a6bede8a38abfc012c299"

headers = {
    "accept": "application/json",
    "x-apikey": "470f77939d3d8c6cfc284916dc75e011784d5eb0d67a6bede8a38abfc012c299"
}

def upload_file(files):
    upload_url = "https://www.virustotal.com/api/v3/files"
    response = requests.post(upload_url, files=files, headers=headers)
    if response :
        return read_report(response.json()['data']['id'])
    else:
        return None

def read_report(id):
    get_stats_url = f'https://www.virustotal.com/api/v3/analyses/{id}'
    response = requests.get(get_stats_url, headers=headers)
    result=response.json()['data']['attributes']['stats']
    if result['malicious'] > 0 or result['suspicious'] > 0 or result['harmless'] >0 :

        return {"result":result,"details":response.json()['data']['attributes']['results']['Kaspersky']['result']}
    else:
        return None





